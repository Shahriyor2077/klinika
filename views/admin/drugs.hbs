{{> admin-sidebar activePage="drugs"}}

<div class="main-content">
    {{> alerts}}

    <h2 class="fw-bold mb-4"><i class="bi bi-capsule me-2"></i>Dorilar</h2>

    <div class="row">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h6 class="m-0"><i class="bi bi-plus-circle me-2"></i>Yangi dori qo'shish</h6>
                </div>
                <div class="card-body">
                    <form action="/admin/drugs/add" method="POST">
                        <div class="mb-3">
                            <input type="text" name="name" class="form-control" placeholder="Dori nomi" minlength="2"
                                maxlength="100" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-plus-lg me-2"></i>Qo'shish
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="m-0">Dorilar ro'yxati ({{length drugs}} ta)</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nomi</th>
                                    <th>Amallar</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each drugs}}
                                <tr>
                                    <td>{{inc @index}}</td>
                                    <td>
                                        <form action="/admin/drugs/edit/{{this._id}}" method="POST"
                                            class="d-flex gap-2 edit-drug-form" style="display: none !important;"
                                            id="edit-form-{{this._id}}">
                                            <input type="text" name="name" class="form-control form-control-sm"
                                                value="{{this.name}}" minlength="2" maxlength="100" required>
                                            <button type="submit" class="btn btn-sm btn-success"><i
                                                    class="bi bi-check"></i></button>
                                            <button type="button" class="btn btn-sm btn-secondary"
                                                onclick="cancelEdit('{{this._id}}')"><i class="bi bi-x"></i></button>
                                        </form>
                                        <span class="fw-semibold drug-name" id="name-{{this._id}}">{{this.name}}</span>
                                    </td>
                                    <td>
                                        <div class="d-flex gap-1">
                                            <button type="button" class="btn btn-sm btn-primary"
                                                onclick="editDrug('{{this._id}}')" title="Tahrirlash">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <form action="/admin/drugs/delete/{{this._id}}?_method=DELETE" method="POST"
                                                class="d-inline">
                                                <button type="button" class="btn btn-sm btn-danger"
                                                    data-confirm="Dorini o'chirmoqchimisiz?" title="O'chirish">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {{else}}
                                <tr>
                                    <td colspan="3" class="text-center text-muted py-4">Dorilar yo'q</td>
                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function editDrug(id) {
        document.getElementById('name-' + id).style.display = 'none';
        document.getElementById('edit-form-' + id).style.display = 'flex';
    }

    function cancelEdit(id) {
        document.getElementById('name-' + id).style.display = 'inline';
        document.getElementById('edit-form-' + id).style.display = 'none';
    }
</script>